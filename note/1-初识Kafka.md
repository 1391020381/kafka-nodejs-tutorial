# Kafka 三大角色

1. 消息系统: Kafka 和传统的消息系统(消息中间件)都具备系统解耦 冗余存储 流量削峰 缓冲 异步通信 扩展性 可恢复性等功能。与此同时,Kafka 还提供了大多数消息系统难以实现的消息顺序性保障及回溯消费的功能。
2. 存储系统: Kafka 把消息持久化到磁盘,相比于其他基于内存存储的系统而言,有效地降低了数据丢失的风险。也正是得益于 Kafka 的消息持久化功能和多副本机制,我们可以把 Kafka 作为长期的数据存储系统来使用,只需要把对应的数据保留策略设置为永久 或启用主题的日志压缩功能即可。
3. 流式处理平台:Kafka 不仅为每个流行的流式处理框架提供了可靠的 shuju 来源,还提供了一个完整的流式处理类库,比如窗口 连接 变换 和聚合等各类操作。

# 基本概念

- 一个典型的 Kafka 体系架构包括若干 Producer 若干 Broker 若干 Consumer 以及一个 Zookeeper 集群。

* Zookeeper 是 Kafka 用来负责集群元数据的管理 控制器的选举等操作的。
* Producer 将消息发送到 Broker,Broker 负责将收到的消息存储到磁盘中
* Consumer 负责从 Broker 订阅并消费消息。

![Kafka](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/3/5/16949bd6279df106~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

- Topic 主题 Kafka 中的消息以主题为单位进行归档分类,生产者负责将消息发送到特定的主题(发送到 Kafka 集群中的每一条消息都要指定一个主题) 而消费者负责订阅主题并进行消费。

* 主题是一个逻辑上的概念,它还可以细分为多个分区,一个分区只属于单个主题,很多时候也会把分区称为主题分区(Topic-Partition)。
* 同一主题下的不同分区包含的消息是不同的, 分区在存储层面可以看作一个可追加的日志(Log)文件,消息在被追加到分区日志文件的时候都会分配一个特定的偏移量(offset)
* offset 是消息在分区中的唯一标识,Kafka 通过它来保证消息在分区内的顺序性,不过 offset 并不跨域分区,也就是说 Kafka 保证的是分区有序而不是主题有序。

* Kafka 消费端也具备一定的容灾能力。 Consumer 使用拉(Pull)模式从服务端拉取消息,并且保存消费的具体位置,当消费者宕机后恢复上线时可根据之前保存的消费位置重新拉取需要的消息进行消费,这样就不会造成消息丢失。
* Kafka 使用的这种 ISR 的方式则有效地权衡了数据可靠性和性能之间的关系。
